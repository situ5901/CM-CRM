<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <!-- Date Range Picker CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
    <style>
        .main {
            display: flex;            align-items: center;
            height: 100vh;
            padding: 10px;
            width: 100%;
            flex-direction: row;
            overflow-x: hidden;
        }

        .cont {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        .cont h1 {
            margin: 0;
            font-size: 2.5rem;
            line-height: 1.4;
        }

        .mainone {
            width: 250px;
            padding: 20px;
            border-top-left-radius: 20px;
            height: 100%;
            background-color: #012141;
            transition: all 0.3s ease;
        }

        .maintwo {
            width: 100%;
            overflow-y: auto;
            padding: 20px;
            height: 100%;
            
        }

        .gradient-text {
            text-align: center;
            background: linear-gradient(to right,
                    #ff0000,
                    /* Red */
                    #ff7f00,
                    /* Orange */
                    #ffff00,
                    /* Yellow */
                    #00ff00,
                    /* Green */
                    #0000ff,
                    /* Blue */
                    #4b0082,
                    /* Indigo */
                    #8f00ff
                    /* Violet */
                );
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 54px;
            animation: rainbow 12s linear infinite;
            background-size: 400% 100%;
        }

        @keyframes rainbow {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 300% 0;
            }
        }


        .vertical-nav {
            width: 210px;
            background: #2c3e50;
            padding: 20px 0;
            border-radius: 10px;
        }

        .vertical-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .vertical-nav li {
            margin: 0;
            padding: 0;
        }

        .vertical-nav a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .vertical-nav a:hover {
            background: #34495e;
            padding-left: 30px;
        }

        .vertical-nav i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
        }

        .vertical-nav span {
            font-size: 16px;
        }

        /* Active link styling */
        .vertical-nav a.active {
            background: #3498db;
            border-left: 4px solid #2980b9;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .vertical-nav {
                width: 100%;
            }

            .vertical-nav span {
                display: none;
            }

            .vertical-nav a {
                justify-content: center;
                padding: 15px;
            }

            .vertical-nav i {
                margin: 0;
                font-size: 20px;
            }
        }

        .flx {
            display: flex;
            width: 100%;
            text-align: center;


        }

        .cont {
            width: 60%;
        }

        .cont2 {
            width: 40%;
            text-align: center;

        }

        .hero-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            padding: 1rem;
            margin-top: -189px;
            flex-direction: row;
        }

        .cont {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
            gap: 2rem;
            margin-top: 240px;
            text-align: center;
        }

        .cont img {
            max-width: 300px;
            height: auto;
        }

        .cont h1 {
            margin: 10px;
            font-size: 2.5rem;
            line-height: 1.4;
        }

        .lottie-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @media (max-width: 768px) {
            .hero-section {
                flex-direction: column;
                text-align: center;
            }

            .lottie-container dotlottie-player {
                width: 300px;
                height: 300px;
            }
        }

        .cont {
            display: inline;
        }

        .one {
            height: 100px;
            width: 120px;
            border-radius: 10px;
            background-color: #243771;
        }

        .two {
            height: 100px;
            width: 120px;
            border-radius: 10px;
            background-color: #243771;
        }

        .three {
            height: 100px;
            width: 120px;
            border-radius: 10px;
            background-color: #243771;
        }

        .four {
            height: 100px;
            width: 120px;
            border-radius: 10px;
            background-color: #243771;
        }

        .focont {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        /* Common styles for all cards */
        .one,
        .two,
        .three,
        .four {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            padding: 15px;
            gap: 10px;
            /* Space between icon and text */
            width: calc(25% - 15px);
            min-width: 100px;
            height: auto;
        }

        /* Icon styles */
        .one i,
        .two i,
        .three i,
        .four i {
            font-size: 2rem;
            /* Adjust icon size */
            margin-bottom: 10px;
        }

        /* Text styles */
        h4 {
            margin: 0;
            font-size: 1.2rem;
        }

        /* Individual card hover effects (optional) */
        .one:hover,
        .two:hover,
        .three:hover,
        .four:hover {
            transform: translateY(-5px);
            transition: transform 0.3s ease;
        }

        /* Media Queries */
        @media (max-width: 1024px) {
            .hero-section {
                flex-direction: column;
            }

            .cont h1 {
                font-size: 24px;
            }

            .gradient-text {
                font-size: 36px;
            }
        }

        @media (max-width: 768px) {
            .main {
                flex-direction: column;
                height: auto;
            }

            .mainone {
                width: 100%;
                height: auto;
                border-radius: 0;
            }

            .maintwo {
                width: 100%;
                padding: 10px;
            }

            .one,
            .two,
            .three,
            .four {
                width: calc(50% - 15px);
            }

            .lottie-container lottie-player {
                width: 300px;
                height: 300px;
            }
        }

        @media (max-width: 480px) {

            .one,
            .two,
            .three,
            .four {
                width: calc(100% - 15px);
            }

            .cont img {
                max-width: 200px;
            }

            .gradient-text {
                font-size: 28px;
            }

            .hero-section {
                padding: 0.5rem;
            }
        }

        .logo-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
            width: 100%;
            background-color: #012141;
            /* Matching your theme */
            margin-bottom: 20px;
        }

        .file-count-display {
            margin: 10px 0;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .file-list {
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            background-color: #f5f5f5;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            justify-content: space-between;
        }
        
        .file-item.uploaded {
            background-color: #e8f5e9;
        }
        
        .file-item.uploaded i {
            color: #4caf50;
        }
        
        .file-item i {
            margin-right: 8px;
        }
        
        .upload-time {
            margin-left: auto;
            font-size: 0.85em;
            color: #666;
        }
        
        .remove-file {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            margin-left: 10px;
            padding: 2px 5px;
        }
        
        .remove-file:hover {
            color: #c0392b;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .file-item:hover {
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .file-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 8px;
            margin-right: 12px;
        }

        .file-icon i {
            font-size: 20px;
            color: #4361ee;
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            color: #2d3436;
            margin-bottom: 4px;
        }

        .file-meta {
            display: flex;
            gap: 12px;
            font-size: 0.85em;
            color: #636e72;
        }

        .collection-type {
            color: #4361ee;
            font-weight: 500;
        }

        .lender-name {
            color: #2ecc71;
            font-weight: 500;
        }

        .upload-time {
            color: #636e72;
        }

        .no-uploads {
            text-align: center;
            padding: 24px;
            color: #636e72;
            background: #f8f9fa;
            border-radius: 8px;
        }

        /* Update the file count display */
        .file-count-display {
            text-align: center;
            padding: 16px;
        }

        .file-count-display span {
            font-size: 24px;
            font-weight: 600;
            color: #4361ee;
            display: block;
            margin: 8px 0;
        }
    </style>
</head>

<body>
    <div class="main">
        <di class="mainone">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='cm.png') }}" alt="Logo" class="logo">
                <h3 style="color: white;text-align: center;">{{ username }}</h3>
            </div>
            <nav class="vertical-nav">
                <ul>
                    <li>
                        <a href="/home">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard">
                            <i class="fas fa-chart-line"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="/attendance">
                            <i class="fas fa-calendar-check"></i>
                            <span>Attendance</span>
                        </a>
                    </li>
                    <li>
                        <a href="/analytical">
                            <i class="fas fa-chart-bar"></i>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li>
                        <a href="/settings">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                    <li>
                        <a href="/data_upload">
                            <i class="fas fa-upload"></i>
                            <span>Upload Data</span>
                        </a>
                    </li>
                    <li>
                        <a href="/ChatBox">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>ChatBox</span>
                        </a>
                    </li>
                    <li>
                        <a href="/logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </li>

                </ul>
            </nav>
        </di>
       <div class="maintwo">
         <div class="main-content" >
            <div class="content-header">
                <h5 class="page-title">Data Upload Dashboard</h5>
                <div class="header-actions">
                    <button class="btn btn-outline">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card" style="background-color: #012141;">
                    <div class="file-count-display">
                        <h3 style="color: white;">Total Uploads</h3>
                        <span id="fileCount">{{ total_uploads }}</span> files Uploads
                    </div>
                </div>
                <div class="stat-card" style="background-color: #012141;">
                    <h3 style="color: white;">Success Rate</h3>
                    <div class="value">98%</div>
                </div>
                <div class="stat-card" style="background-color: #012141;">
                    <h3 style="color: white;">Total Records</h3>
                    <div class="value">85K</div>
                </div>
            </div>

            <!-- Upload Container -->
            <div class="upload-container">
                <!-- Upload Form Section -->
                <div class="upload-section">
                    <h2 class="section-title">Upload Files</h2>
                    <form action="{{ url_for('data_upload') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                        <div class="form-group">
                            <label for="collection_type">
                                <i class="fas fa-database"></i> Select Data Type
                            </label>
                            <select name="collection_type" id="collection_type" required>
                                <option value="">Choose data type...</option>
                                <option value="users">Users</option>
                                <option value="mis">MIS</option>
                            </select>
                        </div>

                        <!-- Add file count display -->
                        
                        
                        <!-- Add file names display -->
                        

                        <div id="file-input-container">
                            <!-- File groups will be added here -->
                        </div>

                        <div class="button-group">
                            <button type="button" class="btn btn-outline" onclick="addFileInput()">
                                <i class="fas fa-plus"></i> Add File
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload"></i> Upload Files
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Recent Uploads Section -->
                <div class="recent-uploads">
                    <h2 class="section-title">Recent Uploads</h2>
                    <div id="fileList" class="file-list">
                        {% if recent_uploads %}
                            {% for upload in recent_uploads %}
                            <div class="file-item uploaded">
                                <div class="file-icon">
                                    <i class="fas fa-file"></i>
                                </div>
                                <div class="file-details">
                                    <div class="file-name">{{ upload.filename }}</div>
                                    <div class="file-meta">
                                        <span class="collection-type">{{ upload.collection_type }}</span>
                                        <span class="lender-name">{{ upload.lender }}</span>
                                        <span class="upload-time">{{ upload.upload_time }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-uploads">
                                <p>No recent uploads found</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
       </div>










    </div>

</body>

</html>







<style>
    :root {
        --primary-color: #4361ee;
        --secondary-color: #3f37c9; 
        --success-color: #2ecc71;
        --danger-color: #e74c3c;
        --text-primary: #2d3436;
        --text-secondary: #636e72;
        --bg-light: #f8f9fa;
        --border-color: #e9ecef;
        --sidebar-width: 260px;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background: #f0f2f5;
        margin: 0;
        padding: 0;
        min-height: 100vh;
    }

    .dashboard-container {
        display: flex;
    }

    /* Sidebar Styles */
    .sidebar {
        width: 260px;
        background: #012141;
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        z-index: 1000;
        padding: 0;
    }

    .logo-section {
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        margin-bottom: 1rem;
    }

    .logo-section img {
        height: 40px;
    }

    .logo-section span {
        color: white;
        font-size: 1.2rem;
    }

    .theme-toggle {
        padding: 1rem;
        text-align: center;
        background: rgba(255, 255, 255, 0.1);
        margin-bottom: 1rem;
    }

    .theme-btn {
        background: none;
        border: none;
        font-size: 1rem;
        color: white;
        cursor: pointer;
    }

    .nav-menu {
        list-style: none;
        padding: 0.5rem;
        margin: 0;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        margin: 0 0.5rem;
    }

    .nav-item {
        padding: 0;
        margin: 0.2rem 0;
    }

    .nav-link {
        color: white;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.8rem 1rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .nav-item.active .nav-link {
        background: rgba(255, 255, 255, 0.1);
    }

    .nav-link:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .nav-link i {
        width: 20px;
        text-align: center;
        font-size: 1.1rem;
    }

    /* Main Content Styles */
    .main-content {
        flex: 1;
        padding: 2rem;
        width: 100%;
    }

    /* Header Section */
    .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .page-title {
        font-size: 1.8rem;
        color: var(--text-primary);
        margin: 0;
    }

    .header-actions {
        display: flex;
        gap: 1rem;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
    }

    .stat-card h3 {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin: 0 0 0.8rem 0;
    }

    .stat-card .value {
        font-size: 2rem;
        font-weight: 600;
        color: var(--primary-color);
    }

    /* Upload Section */
    .upload-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
    }

    .upload-section {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
    }

    .recent-uploads {
        background: white;
        width: 100%;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
    }

    .section-title {
        font-size: 1.2rem;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        padding-bottom: 0.8rem;
        border-bottom: 1px solid var(--border-color);
    }

    /* Form Elements */
    .file-group {
        background: var(--bg-light);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
    }

    select {
        width: 100%;
        padding: 0.8rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }

    .button-group {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .btn {
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: var(--primary-color);
        color: white;
        border: none;
    }

    .btn-outline {
        background: white;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
    }

    /* Recent Uploads List */
    .upload-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .upload-item {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .upload-item:last-child {
        border-bottom: none;
    }

    .upload-icon {
        width: 40px;
        height: 40px;
        background: #e3f2fd;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary-color);
    }

    .upload-details {
        flex: 1;
    }

    .upload-name {
        font-weight: 500;
        margin-bottom: 0.2rem;
    }

    .upload-info {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .secContent {
        border-top-left-radius: 25px;
        padding: 20px;
        background-color: #012141;
        width: 20%;
        justify-content: center;
    }

    .vertical-nav {
        width: 210px;
        background: #2c3e50;
        padding: 30px 0;
        border-radius: 10px;
    }

    .vertical-nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .vertical-nav li {
        margin: 0;
        padding: 0;
    }

    .vertical-nav a {
        display: flex;
        align-items: center;
        padding: 15px 25px;
        color: #ecf0f1;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .vertical-nav a:hover {
        background: #34495e;
        padding-left: 30px;
    }

    .vertical-nav i {
        margin-right: 15px;
        width: 20px;
        text-align: center;
    }

    .vertical-nav span {
        font-size: 16px;
    }

    /* Active link styling */
    .vertical-nav a.active {
        background: #3498db;
        border-left: 4px solid #2980b9;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .vertical-nav {
            width: 100%;
        }

        .vertical-nav span {
            display: none;
        }

        .vertical-nav a {
            justify-content: center;
            padding: 15px;
        }

        .vertical-nav i {
            margin: 0;
            font-size: 20px;
        }
    }

    .containers {
        display: flex;
        padding: 20px;
        width: 100%;
        flex-direction: row;
    }

    /* Add/update responsive styles */
    @media (max-width: 1200px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 992px) {
        .upload-container {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .containers {
            flex-direction: column;
        }

        .secContent {
            width: 100%;
            border-radius: 0;
            margin-bottom: 20px;
        }

        .vertical-nav {
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .vertical-nav ul {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .vertical-nav li {
            flex: 0 0 auto;
        }
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .main-content {
            padding: 1rem;
        }

        .content-header {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }

        .header-actions {
            width: 100%;
            justify-content: center;
        }

        .button-group {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }

        .file-group {
            padding: 1rem;
        }

        .vertical-nav a {
            padding: 10px 15px;
        }

        .vertical-nav span {
            display: none;
        }

        .vertical-nav i {
            margin: 0;
            font-size: 20px;
        }
    }

    @media (max-width: 480px) {
        .page-title {
            font-size: 1.5rem;
        }

        .stat-card {
            padding: 1rem;
        }

        .stat-card .value {
            font-size: 1.5rem;
        }

        .upload-item {
            flex-direction: column;
            text-align: center;
        }

        .upload-icon {
            margin: 0 auto;
        }
    }

    /* Remove the old containers and secContent styles */
    .containers,
    .secContent {
        display: none;
    }

    /* Update responsive styles */
    @media (max-width: 768px) {
        .sidebar {
            width: 70px;
        }

        .logo-section span {
            display: none;
        }

        .nav-link span {
            display: none;
        }

        .main-content {
            /* margin-left: 70px; */
        }
    }
</style>
<script>
    let fileCount = parseInt(sessionStorage.getItem('fileCount')) || 0;
    let uploadedFiles = JSON.parse(sessionStorage.getItem('uploadedFiles')) || [];
    let uploadHistory = JSON.parse(localStorage.getItem('uploadHistory')) || [];

    // Initialize the displays when page loads
    window.onload = function() {
        updateFileCount();
        restoreFileList();
        showUploadHistory();
    }

    function updateFileCount() {
        const fileCountElement = document.getElementById('fileCount');
        fileCountElement.textContent = fileCount + uploadHistory.length;
        sessionStorage.setItem('fileCount', fileCount);
    }

    function showUploadHistory() {
        const fileList = document.getElementById('fileList');
        
        // Create a Map to track unique file names
        const uniqueFiles = new Map();
        
        // Get only the most recent entry for each file name
        uploadHistory.forEach((fileInfo) => {
            const key = `${fileInfo.name}-${fileInfo.lender}`;
            if (!uniqueFiles.has(key) || 
                new Date(fileInfo.uploadTime) > new Date(uniqueFiles.get(key).uploadTime)) {
                uniqueFiles.set(key, fileInfo);
            }
        });
        
        // Display only unique entries
        uniqueFiles.forEach((fileInfo) => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item uploaded';
            fileItem.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <div class="file-details">
                    <div class="file-name">${fileInfo.name}</div>
                    <div class="file-meta">
                        <span class="collection-type">${fileInfo.collection || 'N/A'}</span>
                        <span class="lender-name">${fileInfo.lender || 'N/A'}</span>
                    </div>
                </div>
                <span class="upload-time">${fileInfo.uploadTime}</span>
                <button onclick="removeHistoryItem('${fileInfo.name}')" class="remove-file">
                    <i class="fas fa-times"></i>
                </button>
            `;
            fileList.appendChild(fileItem);
        });
    }

    function removeHistoryItem(fileName) {
        // Remove all entries with this file name
        uploadHistory = uploadHistory.filter(item => item.name !== fileName);
        localStorage.setItem('uploadHistory', JSON.stringify(uploadHistory));
        updateFileCount();
        restoreFileList();
    }

    function restoreFileList() {
        const fileList = document.getElementById('fileList');
        fileList.innerHTML = '';
        
        // Show upload history first
        showUploadHistory();
        
        // Then show current files
        uploadedFiles.forEach(fileName => {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item current';
            fileItem.innerHTML = `
                <i class="fas fa-file"></i>
                ${fileName}
                <button onclick="removeFile('${fileName}')" class="remove-file">
                    <i class="fas fa-times"></i>
                </button>
            `;
            fileList.appendChild(fileItem);
        });
    }

    function removeFile(fileName) {
        uploadedFiles = uploadedFiles.filter(name => name !== fileName);
        sessionStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
        fileCount--;
        updateFileCount();
        restoreFileList();
    }

    function updateFileList() {
        const fileList = document.getElementById('fileList');
        fileList.innerHTML = '';
        
        // Show upload history first
        showUploadHistory();
        
        const inputs = document.querySelectorAll('input[type="file"]');
        inputs.forEach(input => {
            if (input.files.length > 0) {
                const fileName = input.files[0].name;
                if (!uploadedFiles.includes(fileName)) {
                    uploadedFiles.push(fileName);
                }
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item current';
                fileItem.innerHTML = `
                    <i class="fas fa-file"></i>
                    ${fileName}
                    <button onclick="removeFile('${fileName}')" class="remove-file">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                fileList.appendChild(fileItem);
            }
        });
        
        sessionStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
    }

    function addFileInput() {
        const fileInputContainer = document.getElementById("file-input-container");
        const fileGroup = document.createElement("div");
        fileGroup.classList.add("file-group");

        const lenderLabel = document.createElement("label");
        lenderLabel.innerHTML = '<i class="fas fa-building"></i> Select Lender:';
        const lenderSelect = document.createElement("select");
        lenderSelect.name = "lender";
        lenderSelect.required = true;
        lenderSelect.innerHTML = `
            <option value="Cashe">Cashe</option>
            <option value="MoneyView">MoneyView</option>
            <option value="Prefer">Prefer</option>
            <option value="SmartCoin">SmartCoin</option>
            <option value="MVCancel">MVCancel</option>
            <option value="Ramfin">Ramfin</option>
            <option value="Mpokket">Mpokket</option>
        `;

        const fileLabel = document.createElement("label");
        fileLabel.innerText = "Upload CSV or Excel file:";
        const newInput = document.createElement("input");
        newInput.type = "file";
        newInput.name = "file";
        newInput.accept = ".csv, .xlsx";
        newInput.required = true;
        newInput.onchange = function() {
            updateRecordCount(this);
            fileCount++;
            updateFileCount();
            updateFileList();
        };

        const recordCountSpan = document.createElement("span");
        recordCountSpan.classList.add("record-count");
        recordCountSpan.innerHTML = '<i class="fas fa-table"></i> <span>0 records</span>';

        const deleteButton = document.createElement("button");
        deleteButton.type = "button";
        deleteButton.classList.add("delete-btn");
        deleteButton.innerHTML = '<i class="fas fa-trash"></i> Delete';
        deleteButton.onclick = function() {
            fileInputContainer.removeChild(fileGroup);
            fileCount--;
            updateFileCount();
            updateFileList();
        };

        fileGroup.appendChild(lenderLabel);
        fileGroup.appendChild(lenderSelect);
        fileGroup.appendChild(fileLabel);
        fileGroup.appendChild(newInput);
        fileGroup.appendChild(recordCountSpan);
        fileGroup.appendChild(deleteButton);

        fileInputContainer.appendChild(fileGroup);
    }

    function updateRecordCount(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const content = e.target.result;
                const lines = content.split(/\r\n|\n/);
                const totalCount = lines.length - 1; // Assuming the first line is the header
                input.nextElementSibling.innerText = `${totalCount} records`;
            };
            reader.readAsText(file);
        }

    }

    // Update form submit handler
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const files = document.querySelectorAll('input[type="file"]');
        const uploadData = [];

        files.forEach(fileInput => {
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const lenderSelect = fileInput.closest('.file-group').querySelector('select[name="lender"]');
                
                uploadData.push({
                    filename: file.name,
                    lender: lenderSelect.value,
                    upload_time: new Date().toISOString(),
                    collection_type: document.getElementById('collection_type').value
                });
            }
        });

        if (uploadData.length === 0) {
            alert('Please select at least one file to upload');
            return;
        }

        // First save the upload history
        fetch('/save_upload_history', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                files: uploadData
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                // Reload the page to show updated list
                window.location.reload();
            } else {
                throw new Error(data.error || 'Error saving upload history');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error saving upload history: ' + error.message);
        });
    });

    // Add styles for new elements
    const additionalStyles = `
        .file-details {
            flex: 1;
            margin-right: 10px;
        }
        
        .file-name {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .file-meta {
            font-size: 0.8em;
            color: #666;
        }
        
        .file-meta span {
            margin-right: 10px;
        }
        
        .collection-type {
            color: #2196F3;
        }
        
        .lender-name {
            color: #4CAF50;
        }
    `;

    // Add the new styles to the existing style element
    document.querySelector('style').textContent += additionalStyles;
</script>